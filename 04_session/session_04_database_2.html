<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Computational Archaeology</title>
    <meta charset="utf-8" />
    <meta name="author" content="Martin Hinz" />
    <script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
    <script src="libs/viz-0.3/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.1/grViz.js"></script>
    <link rel="stylesheet" href="../libs/default.css" type="text/css" />
    <link rel="stylesheet" href="../libs/default-fonts.css" type="text/css" />
    <link rel="stylesheet" href="../libs/customize.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: title-slide, center, middle


#  Computational Archaeology

##  04 - Database 2

###  Martin Hinz

####  Institut für Archäologische Wissenschaften, Universität Bern

25/09/19

---
## Designing a data model
### Entity - Relationship (ER)

.pull-left[
**Entity:**&lt;sup&gt;\*&lt;/sup&gt;   Real-world object, distinguishable from other objects. An entity is described using a set of attributes. 

**Relationship:**&lt;sup&gt;\*&lt;/sup&gt;  Association among two or more entities.  E.g., a fibula was found at Münsingen.
- relationships can have their own attributes.
]

.pull-right[
<div id="htmlwidget-cc1443162b54b1226b68" style="width:400px;height:100px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-cc1443162b54b1226b68">{"x":{"diagram":"\ndigraph models_diagram {\n    rankdir=\"LR\";\n    graph[overlap=false, splines=true]\n    \"site\" [shape=record, label=\"{\\\n      site|name :string\\l\\\n      lat :float\\l\\\n      lng :float\\l\\\n    }\"]\n    \n    \"artefact\" [shape=record, label=\"{artefact|\\\n      material :string\\l\\\n      weight :string\\l\\\n    }\"]\n    \n    \"found_at\" [shape=diamond, label=\"\n      found_at\\l\\\n      date :datetime\n    \"]\n    \n\n    \"site\" -> \"found_at\" [label=\"1\"]\n    \"found_at\" -> \"artefact\" [label=\"N\"]\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
]

.footnote[.tiny[&lt;sup&gt;\*&lt;/sup&gt;**Entity Set:**  A collection of similar entities.  E.g., all employees.
- All entities in an entity set have the same set of attributes. (Basically)
- Each entity set has a key (!).
- Each attribute has a domain, that means, a range of possible values.

&lt;sup&gt;\*&lt;/sup&gt;**Relationship Set:**  Collection of similar relationships.
]]

---
## Types of Relationships

### 1:1, 1:n, n:m

.pull-left[
#### Examples

- potsherds and features (n:m)
  - the sherds of one pot can be found at 1:n features
  - a feature can contain 1:n potsherds
  
- sample and measurements (1:n)
  - 1 sample has 1:n measurements
  
- artefact and find lable (1:1)
  - 1 Artefact has 1 find label
]

.pull-right[
![](../images/03_session/relationships.png)
]
---
## (primary) keys

Each record must be uniquely identifiable.

Primary key!

either
  - a set of attributes that are already there and make the record unique
    - example: Lab Code and Lab Number identify a radiocarbon date

or
 - is an explicit (artificial) attribute that is a sequential number
    - example: an id number from 1...&amp;infin;

**The latter is not pure dogma, but most of the time more pratical**

---
## (primary &amp; foreign) keys

If a record is uniquely identifiable, this can be used in relation to other entities:

.pull-left[
.pull-left[
|sites|
|-----------|
| Münsingen |
| Worb      |

]
.pull-right[
|burials|
|----------|
| Burial 1 |
| Burial 2 |
| Burial 3 |
| Burial 1 |
| Burial 2 |
| Burial 3 |
]
]

.pull-right[
.pull-left[
| id | site      |
|----|-----------|
| 1  | Münsingen |
| 2  | Worb      |
]
.pull-right[
| id | burial   | site_id |
|----|----------|---------|
| 1  | Burial 1 | 1       |
| 2  | Burial 2 | 1       |
| 3  | Burial 3 | 1       |
| 4  | Burial 1 | 2       |
| 5  | Burial 2 | 2       |
| 6  | Burial 3 | 2       |
]
]

The identifier of a record is the **primary key**.

The identifier of another record in relation to this one is the **foreign key**.

---
## Normalisation

&gt; **Database normalization** is the process of structuring a relational database in accordance with a series of so-called normal forms in order **to reduce data redundancy** and **improve data integrity**. -- wikipedia

.small[

### 1NF
To satisfy 1NF, the values in each column of a table must be **atomic**. (Meaning one information at the time)

### 2NF
Each data record represents only one fact. If there is data in a table that does not represent only 1 fact, this data is subdivided into individual thematic tables.

or more formal:

It does not have any non-prime attribute that is functionally dependent on any proper subset of any candidate key of the relation. A non-prime attribute of a relation is an attribute that is not a part of any candidate key of the relation.

### 3NF
No data in a record should automatically follow from other data in the same record.
]

---
## That's enought

There also exists the 4th, 5th and 6th Normal Form (not to mention the Boyce–Codd normal form (BCNF))...

In practise, normalising to the 3th Normal Form is absolutely enough.

&gt; Informally, a relational database relation is often described as "normalized" if it meets third normal form. Most 3NF relations are free of insertion, update, and deletion anomalies. -- wikipedia

Most of that comes naturally if you think about your relations as objects in the 'Real World'&lt;sup&gt;tm&lt;/sup&gt;.
---
## Let's get practical

.pull-left[
We want to design a data base for finds of the site Prag-Miškovice.

.tiny[Do not fear, the book is in German!]

What **Informations** do we like to record?

What **Entities** and **Relations** do we have?

What **Attributes** will the **Entities** have?

How can we transform that into tables (this usually comes naturally than)?
]

.pull-right[
![](../images/03_session/miskovice_screenshot.png)
]
---
## Structure MiscoviceDB

### Draft

.center[
![:width 70%](../images/04_session/db_draft.jpg)
]

---
## Structure MiscoviceDB

### ER-Diagramm

<div id="htmlwidget-a4e735f61693670ef78e" style="width:800px;height:400px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-a4e735f61693670ef78e">{"x":{"diagram":"\ndigraph models_diagram {\n    rankdir=\"LR\";\n    graph[overlap=false, splines=true]\n    \"sites\" [shape=record, label=\"{\\\n      sites|name :string\\l\\\n      lat :float\\l\\\n      lng :float\\l\\\n    }\"]\n    \n    \"graves\" [shape=record, label=\"{graves|\\\n      grave_number :string\\l\\\n      depth :float\\l\\\n      length :float\\l\\\n      width :float\\l\\\n      construction :text\\l\\\n    }\"]\n    \n    \"individuals\" [shape=record, label=\"{individuals|\\\n      sex :string\\l\\\n      age :string\\l\\\n      orientation :float\\l\\\n      completeness :float\\l\\\n    }\"]\n    \n    \"artefacts\" [shape=record, label=\"{artefacts|\\\n      name :string\\l\\\n      type :string\\l\\\n      material :string\\l\\\n    }\"]\n    \n    \"c14_dates\" [shape=record, label=\"{c14_dates|\\\n      lab_code :string\\l\\\n      bp :integer\\l\\\n      std :integer\\l\\\n    }\"]\n\n    \"sites\" -> \"graves\" [label=\"1:n\"]\n    \"graves\" -> \"artefacts\" [label=\"1:n\"]\n    \"graves\" -> \"individuals\" [label=\"1:n\"]\n    \"graves\" -> \"c14_dates\" [label=\"1:n\"]\n    \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
---
## Structure MiscoviceDB

### Primary and foreign keys

<div id="htmlwidget-b50083824020e13abd04" style="width:800px;height:400px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-b50083824020e13abd04">{"x":{"diagram":"\ndigraph models_diagram {\n    rankdir=\"LR\";\n    graph[overlap=false, splines=true]\n    \"sites\" [shape=record, label=\"{sites|\\\n      id :integer\\l\\\n      name :string\\l\\\n      lat :float\\l\\\n      lng :float\\l\\\n    }\"]\n    \n    \"graves\" [shape=record, label=\"{graves|\\\n      id :integer\\l\\\n      site_id :integer\\l\\\n      grave_number :string\\l\\\n      depth :float\\l\\\n      length :float\\l\\\n      width :float\\l\\\n      construction :text\\l\\\n    }\"]\n    \n    \"individuals\" [shape=record, label=\"{individuals|\\\n      id :integer\\l\\\n      grave_id :integer\\l\\\n      sex :string\\l\\\n      age :string\\l\\\n      orientation :float\\l\\\n      completeness :float\\l\\\n    }\"]\n    \n    \"artefacts\" [shape=record, label=\"{artefacts|\\\n      id :integer\\l\\\n      grave_id :integer\\l\\\n      name :string\\l\\\n      type :string\\l\\\n      material :string\\l\\\n    }\"]\n    \n    \"c14_dates\" [shape=record, label=\"{c14_dates|\\\n      id :integer\\l\\\n      grave_id :integer\\l\\\n      lab_code :string\\l\\\n      bp :integer\\l\\\n      std :integer\\l\\\n    }\"]\n\n    \"sites\" -> \"graves\" [label=\"1:n\"]\n    \"graves\" -> \"artefacts\" [label=\"1:n\"]\n    \"graves\" -> \"individuals\" [label=\"1:n\"]\n    \"graves\" -> \"c14_dates\" [label=\"1:n\"]\n    \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
---
## Structure MiscoviceDB

### Lookup tables

<div id="htmlwidget-0930d04d43cbecd86866" style="width:800px;height:400px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-0930d04d43cbecd86866">{"x":{"diagram":"\ndigraph models_diagram {\n    rankdir=\"LR\";\n    graph[overlap=false, splines=true]\n    \"sites\" [shape=record, label=\"{sites|\\\n      id :integer\\l\\\n      name :string\\l\\\n      lat :float\\l\\\n      lng :float\\l\\\n    }\"]\n    \n    \"graves\" [shape=record, label=\"{graves|\\\n      id :integer\\l\\\n      site_id :integer\\l\\\n      grave_number :string\\l\\\n      depth :float\\l\\\n      length :float\\l\\\n      width :float\\l\\\n      construction :text\\l\\\n    }\"]\n    \n    \"individuals\" [shape=record, label=\"{individuals|\\\n      id :integer\\l\\\n      grave_id :integer\\l\\\n      sex_id :integer\\l\\\n      age_id :integer\\l\\\n      orientation :float\\l\\\n      completeness :float\\l\\\n    }\"]\n    \n    \"sexes\" [shape=record, label=\"{sexes|\\\n      id :integer\\l\\\n      name :string\\l\\\n    }\"]\n    \n    \"artefacts\" [shape=record, label=\"{artefacts|\\\n      id :integer\\l\\\n      grave_id :integer\\l\\\n      name :string\\l\\\n      type_id :integer\\l\\\n      material_id :integer\\l\\\n    }\"]\n    \n    \"types\" [shape=record, label=\"{types|\\\n      id :integer\\l\\\n      name :string\\l\\\n    }\"]\n    \n    \"materials\" [shape=record, label=\"{materials|\\\n      id :integer\\l\\\n      name :string\\l\\\n    }\"]\n    \n    \"ages\" [shape=record, label=\"{ages|\\\n      id :integer\\l\\\n      name :string\\l\\\n    }\"]\n    \n    \"c14_dates\" [shape=record, label=\"{c14_dates|\\\n      id :integer\\l\\\n      grave_id :integer\\l\\\n      lab_code :string\\l\\\n      bp :integer\\l\\\n      std :integer\\l\\\n    }\"]\n\n    \"sites\" -> \"graves\" [label=\"1:n\"]\n    \"graves\" -> \"artefacts\" [label=\"1:n\"]\n    \"graves\" -> \"individuals\" [label=\"1:n\"]\n    \"graves\" -> \"c14_dates\" [label=\"1:n\"]\n    \"types\" -> \"artefacts\" [label=\"1:n\"]\n    \"materials\" -> \"artefacts\" [label=\"1:n\"]\n    \"sexes\" -> \"individuals\" [label=\"1:n\"]\n    \"ages\" -> \"individuals\" [label=\"1:n\"]\n    \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
---
## Tables

---
## Relationsships

---
## Forms

---
## Data Entry

---
## Queries

---
class: inverse, middle, center
# Any questions?

.footnote[
.right[
.tiny[
You might find the course material (including the presentations) at

https://github.com/MartinHinz/ca_hs_2019

You can see the rendered presentations at

http://martinhinz.github.io/ca_hs_2019

You can contact me at

&lt;a href="mailto:martin.hinz@iaw.unibe.ch"&gt;martin.hinz@iaw.unibe.ch&lt;/a&gt;

Sources for the slides:

'Introduction to Database Systems' (Hellerstein/Olston 2005)
'Introduction to Database Development' (Paterson)
]
]
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../libs/remark-latest.min.js"></script>
<script src="../libs/macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"fig_caption": true,
"ratio": "16:10"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
